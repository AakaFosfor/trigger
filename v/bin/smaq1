#!/bin/bash
#to be started on alidcsvme001
# smaq CTP_INPUT DIRNAME
#rc: 8: smaq is already running
# smaq kill
. $CCRFS/usr/local/trigger/bin/auxfunctions
getpid '/usr/local/trigger/v/vme/smaq1/smaq.exe'
#echo "$spid user:$user"
if [ $# -eq 0 ] ;then
  echo "Usage:"
  echo "smaq1 ctp_input DIRNAME"
  echo "DIRNAME -this directory is created at trigger@alidcscom027:SMAQ/"
  echo "         if missing, 'last' is used (it will be emptied before usage)"
  echo "smaq1 kill -kill active smaq1"
  exit
fi
if [ -n "$spid" ] ;then
  if [ $1 = 'kill' ] ;then
    kill -9 "$spid"
    echo "$spid killed"
    exit 0
  else
    echo "smaq1 already running: pid:$spid user:$user"
    exit 8
  fi
fi
sig=$1
if [ $# -ge 2 ] ;then
  export SMAQDATA="$2"
  ssh -q2 trigger@alidcscom027 "mkdir -p SMAQ/$SMAQDATA"
else
  export SMAQDATA="last"
  ssh -q2 trigger@alidcscom027 "mkdir -p SMAQ/$SMAQDATA"
  ssh -q2 trigger@alidcscom027 "rm -rf SMAQ/$SMAQDATA/*"
fi
scp -Bq2 $VMECFDIR/CFG/ctp/DB/VALID.CTPINPUTS trigger@alidcscom027:SMAQ/$SMAQDATA/
cd ~/v/vme
#$VMECFDIR/inputs/inputs.exe <<-EOF
#inputsSMAQ(0,$sig)
#EOF
$VMECFDIR/smaq1/smaq.exe $sig <<-EOF
EOF
